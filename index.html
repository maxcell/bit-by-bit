<html>
<head>
  <title>Bit By Bit | Home</title>
  <script>
    var connection = new WebSocket('wss://ws.blockchain.info/inv'/*,['soap', 'xmpp']*/);
    connection.onopen = function(){
      console.log("Opened connection.");
      connection.send('{"op":"unconfirmed_sub"}');
    }
    connection.onmessage = function(e){

      var transactionDictionary = (JSON.parse(e.data)["x"]);
      /*
      console.log("Inside x: " + transactionDictionary["x"]);
      console.log("size: " + transactionDictionary["x"]["size"]);
      console.log("inputs: " + transactionDictionary["x"]["size"]["inputs"]);
      */


      //Access properties
      var size = transactionDictionary["size"];
      var time = transactionDictionary["time"];
      var transactionIndex = transactionDictionary["tx_index"];
      var hash = transactionDictionary["hash"];
      var lockTime = transactionDictionary["lock_time"];

      //Input/Output UTXOs -- testing
      var inputAddresses = [];
      var inputSatoshi = 0;
      var outputAddresses = [];
      var outputSatoshi = 0;

      var inputsArray = transactionDictionary["inputs"];
      var outputsArray = transactionDictionary["out"];

      console.log("The transaction " + transactionIndex + ": has size " + size + " and hash of " + hash + " at time " + time);
      console.log("UTXO Inputs: " + inputsArray.length + "    Outputs: " + outputsArray.length); // Amount of input/outputs UTXOs

      //Get more transaction details
      //Inputs
      for( i = 0; i < inputsArray.length; i++) {
          //console.log(i.toString() + " : "+ inputsArray[i]["prev_out"]["addr"] );
          inputAddresses.push(inputsArray[i]["prev_out"]["addr"])
          inputSatoshi += inputsArray[i]["prev_out"]["value"]
      }

      //Outputs
      for (j = 0; j < outputsArray.length; j++) {
          outputAddresses.push(outputsArray[j]["addr"])
          outputSatoshi += outputsArray[j]["value"]
      }

      console.log("Input satoshi: " + inputSatoshi + "    Output Satoshi: " + outputSatoshi);
      console.log("--------------------------")

    }
  </script>
</head>
<body>
</body>
</html>
